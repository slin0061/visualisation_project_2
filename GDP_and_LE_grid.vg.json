{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Decade trends: GDP per capita (US$) and life expectancy (years) for AUS, CHN, JPN, NZL, IND, MYS.",
  "config": {
    "view": {"stroke": "#444", "strokeWidth": 1.2},
    "axis": {"labelFontSize": 11, "titleFontSize": 11},
    "legend": {"orient": "bottom", "direction": "horizontal"}
  },
  "resolve": {"legend": {"color": "shared"}},
  "vconcat": [
    {
      "hconcat": [
        {
          "title": "Australia",
          "data": {"url": "data/API_NY.GDP.PCAP.CD_DS2_en_csv_v2_1233921.csv", "format": {"type": "csv"}},
          "transform": [
            {"filter": "datum['Country Code'] == 'AUS'"},
            {"fold": ["1960","1970","1980","1990","2000","2010","2020"], "as": ["year","gdp_pc"]},
            {"calculate": "toNumber(datum.gdp_pc)", "as": "gdp_pc_num"},
            {"calculate": "toNumber(datum.year)", "as": "yearNum"},
            {
              "lookup": "Country Code",
              "from": {
                "data": {"url": "data/API_SP.DYN.LE00.IN_DS2_en_csv_v2_22997.csv", "format": {"type": "csv"}},
                "key": "Country Code",
                "fields": ["Indicator Code","1960","1970","1980","1990","2000","2010","2020"]
              },
              "as": ["le_indicator","le_1960","le_1970","le_1980","le_1990","le_2000","le_2010","le_2020"]
            },
            {"filter": "datum.le_indicator == 'SP.DYN.LE00.IN'"},
            {"calculate": "toNumber(datum['le_' + datum.year])", "as": "life_exp_num"},
            {"filter": "isFinite(datum.gdp_pc_num) && isFinite(datum.life_exp_num)"}
          ],
          "width": 260,
          "height": 180,
          "layer": [
            {
              "transform": [{"calculate": "'GDP per capita'", "as": "series"}],
              "mark": {"type": "line", "point": {"filled": true}},
              "encoding": {
                "x": {"field": "yearNum", "type": "quantitative", "title": "Year", "axis": {"format": "d"}},
                "y": {"field": "gdp_pc_num", "type": "quantitative", "title": "GDP per capita (US$)", "axis": {"grid": true}},
                "color": {
                  "field": "series",
                  "type": "nominal",
                  "scale": {"domain": ["GDP per capita","Life expectancy"], "range": ["#1f77b4","#ff7f0e"]},
                  "legend": {"title": ""}
                }
              }
            },
            {
              "transform": [{"calculate": "'Life expectancy'", "as": "series"}],
              "mark": {"type": "line", "point": {"filled": true}},
              "encoding": {
                "x": {"field": "yearNum", "type": "quantitative", "title": "Year", "axis": {"format": "d"}},
                "y": {"field": "life_exp_num", "type": "quantitative", "title": "Life expectancy (years)", "axis": {"orient": "right"}},
                "color": {
                  "field": "series",
                  "type": "nominal",
                  "scale": {"domain": ["GDP per capita","Life expectancy"], "range": ["#1f77b4","#ff7f0e"]},
                  "legend": {"title": ""}
                }
              }
            }
          ],
          "resolve": {"scale": {"y": "independent"}}
        },
        {
          "title": "China",
          "data": {"url": "data/API_NY.GDP.PCAP.CD_DS2_en_csv_v2_1233921.csv", "format": {"type": "csv"}},
          "transform": [
            {"filter": "datum['Country Code'] == 'CHN'"},
            {"fold": ["1960","1970","1980","1990","2000","2010","2020"], "as": ["year","gdp_pc"]},
            {"calculate": "toNumber(datum.gdp_pc)", "as": "gdp_pc_num"},
            {"calculate": "toNumber(datum.year)", "as": "yearNum"},
            {
              "lookup": "Country Code",
              "from": {
                "data": {"url": "data/API_SP.DYN.LE00.IN_DS2_en_csv_v2_22997.csv", "format": {"type": "csv"}},
                "key": "Country Code",
                "fields": ["Indicator Code","1960","1970","1980","1990","2000","2010","2020"]
              },
              "as": ["le_indicator","le_1960","le_1970","le_1980","le_1990","le_2000","le_2010","le_2020"]
            },
            {"filter": "datum.le_indicator == 'SP.DYN.LE00.IN'"},
            {"calculate": "toNumber(datum['le_' + datum.year])", "as": "life_exp_num"},
            {"filter": "isFinite(datum.gdp_pc_num) && isFinite(datum.life_exp_num)"}
          ],
          "width": 260,
          "height": 180,
          "layer": [
            {
              "transform": [{"calculate": "'GDP per capita'", "as": "series"}],
              "mark": {"type": "line", "point": {"filled": true}},
              "encoding": {
                "x": {"field": "yearNum", "type": "quantitative", "title": "Year", "axis": {"format": "d"}},
                "y": {"field": "gdp_pc_num", "type": "quantitative", "title": "GDP per capita (US$)", "axis": {"grid": true}},
                "color": {
                  "field": "series",
                  "type": "nominal",
                  "scale": {"domain": ["GDP per capita","Life expectancy"], "range": ["#1f77b4","#ff7f0e"]},
                  "legend": {"title": ""}
                }
              }
            },
            {
              "transform": [{"calculate": "'Life expectancy'", "as": "series"}],
              "mark": {"type": "line", "point": {"filled": true}},
              "encoding": {
                "x": {"field": "yearNum", "type": "quantitative", "title": "Year", "axis": {"format": "d"}},
                "y": {"field": "life_exp_num", "type": "quantitative", "title": "Life expectancy (years)", "axis": {"orient": "right"}},
                "color": {
                  "field": "series",
                  "type": "nominal",
                  "scale": {"domain": ["GDP per capita","Life expectancy"], "range": ["#1f77b4","#ff7f0e"]},
                  "legend": {"title": ""}
                }
              }
            }
          ],
          "resolve": {"scale": {"y": "independent"}}
        },
        {
          "title": "Japan",
          "data": {"url": "data/API_NY.GDP.PCAP.CD_DS2_en_csv_v2_1233921.csv", "format": {"type": "csv"}},
          "transform": [
            {"filter": "datum['Country Code'] == 'JPN'"},
            {"fold": ["1960","1970","1980","1990","2000","2010","2020"], "as": ["year","gdp_pc"]},
            {"calculate": "toNumber(datum.gdp_pc)", "as": "gdp_pc_num"},
            {"calculate": "toNumber(datum.year)", "as": "yearNum"},
            {
              "lookup": "Country Code",
              "from": {
                "data": {"url": "data/API_SP.DYN.LE00.IN_DS2_en_csv_v2_22997.csv", "format": {"type": "csv"}},
                "key": "Country Code",
                "fields": ["Indicator Code","1960","1970","1980","1990","2000","2010","2020"]
              },
              "as": ["le_indicator","le_1960","le_1970","le_1980","le_1990","le_2000","le_2010","le_2020"]
            },
            {"filter": "datum.le_indicator == 'SP.DYN.LE00.IN'"},
            {"calculate": "toNumber(datum['le_' + datum.year])", "as": "life_exp_num"},
            {"filter": "isFinite(datum.gdp_pc_num) && isFinite(datum.life_exp_num)"}
          ],
          "width": 260,
          "height": 180,
          "layer": [
            {
              "transform": [{"calculate": "'GDP per capita'", "as": "series"}],
              "mark": {"type": "line", "point": {"filled": true}},
              "encoding": {
                "x": {"field": "yearNum", "type": "quantitative", "title": "Year", "axis": {"format": "d"}},
                "y": {"field": "gdp_pc_num", "type": "quantitative", "title": "GDP per capita (US$)", "axis": {"grid": true}},
                "color": {
                  "field": "series",
                  "type": "nominal",
                  "scale": {"domain": ["GDP per capita","Life expectancy"], "range": ["#1f77b4","#ff7f0e"]},
                  "legend": {"title": ""}
                }
              }
            },
            {
              "transform": [{"calculate": "'Life expectancy'", "as": "series"}],
              "mark": {"type": "line", "point": {"filled": true}},
              "encoding": {
                "x": {"field": "yearNum", "type": "quantitative", "title": "Year", "axis": {"format": "d"}},
                "y": {"field": "life_exp_num", "type": "quantitative", "title": "Life expectancy (years)", "axis": {"orient": "right"}},
                "color": {
                  "field": "series",
                  "type": "nominal",
                  "scale": {"domain": ["GDP per capita","Life expectancy"], "range": ["#1f77b4","#ff7f0e"]},
                  "legend": {"title": ""}
                }
              }
            }
          ],
          "resolve": {"scale": {"y": "independent"}}
        }
      ]
    },
    {
      "hconcat": [
        {
          "title": "New Zealand",
          "data": {"url": "data/API_NY.GDP.PCAP.CD_DS2_en_csv_v2_1233921.csv", "format": {"type": "csv"}},
          "transform": [
            {"filter": "datum['Country Code'] == 'NZL'"},
            {"fold": ["1960","1970","1980","1990","2000","2010","2020"], "as": ["year","gdp_pc"]},
            {"calculate": "toNumber(datum.gdp_pc)", "as": "gdp_pc_num"},
            {"calculate": "toNumber(datum.year)", "as": "yearNum"},
            {
              "lookup": "Country Code",
              "from": {
                "data": {"url": "data/API_SP.DYN.LE00.IN_DS2_en_csv_v2_22997.csv", "format": {"type": "csv"}},
                "key": "Country Code",
                "fields": ["Indicator Code","1960","1970","1980","1990","2000","2010","2020"]
              },
              "as": ["le_indicator","le_1960","le_1970","le_1980","le_1990","le_2000","le_2010","le_2020"]
            },
            {"filter": "datum.le_indicator == 'SP.DYN.LE00.IN'"},
            {"calculate": "toNumber(datum['le_' + datum.year])", "as": "life_exp_num"},
            {"filter": "isFinite(datum.gdp_pc_num) && isFinite(datum.life_exp_num)"}
          ],
          "width": 260,
          "height": 180,
          "layer": [
            {
              "transform": [{"calculate": "'GDP per capita'", "as": "series"}],
              "mark": {"type": "line", "point": {"filled": true}},
              "encoding": {
                "x": {"field": "yearNum", "type": "quantitative", "title": "Year", "axis": {"format": "d"}},
                "y": {"field": "gdp_pc_num", "type": "quantitative", "title": "GDP per capita (US$)", "axis": {"grid": true}},
                "color": {
                  "field": "series",
                  "type": "nominal",
                  "scale": {"domain": ["GDP per capita","Life expectancy"], "range": ["#1f77b4","#ff7f0e"]},
                  "legend": {"title": ""}
                }
              }
            },
            {
              "transform": [{"calculate": "'Life expectancy'", "as": "series"}],
              "mark": {"type": "line", "point": {"filled": true}},
              "encoding": {
                "x": {"field": "yearNum", "type": "quantitative", "title": "Year", "axis": {"format": "d"}},
                "y": {"field": "life_exp_num", "type": "quantitative", "title": "Life expectancy (years)", "axis": {"orient": "right"}},
                "color": {
                  "field": "series",
                  "type": "nominal",
                  "scale": {"domain": ["GDP per capita","Life expectancy"], "range": ["#1f77b4","#ff7f0e"]},
                  "legend": {"title": ""}
                }
              }
            }
          ],
          "resolve": {"scale": {"y": "independent"}}
        },
        {
          "title": "India",
          "data": {"url": "data/API_NY.GDP.PCAP.CD_DS2_en_csv_v2_1233921.csv", "format": {"type": "csv"}},
          "transform": [
            {"filter": "datum['Country Code'] == 'IND'"},
            {"fold": ["1960","1970","1980","1990","2000","2010","2020"], "as": ["year","gdp_pc"]},
            {"calculate": "toNumber(datum.gdp_pc)", "as": "gdp_pc_num"},
            {"calculate": "toNumber(datum.year)", "as": "yearNum"},
            {
              "lookup": "Country Code",
              "from": {
                "data": {"url": "data/API_SP.DYN.LE00.IN_DS2_en_csv_v2_22997.csv", "format": {"type": "csv"}},
                "key": "Country Code",
                "fields": ["Indicator Code","1960","1970","1980","1990","2000","2010","2020"]
              },
              "as": ["le_indicator","le_1960","le_1970","le_1980","le_1990","le_2000","le_2010","le_2020"]
            },
            {"filter": "datum.le_indicator == 'SP.DYN.LE00.IN'"},
            {"calculate": "toNumber(datum['le_' + datum.year])", "as": "life_exp_num"},
            {"filter": "isFinite(datum.gdp_pc_num) && isFinite(datum.life_exp_num)"}
          ],
          "width": 260,
          "height": 180,
          "layer": [
            {
              "transform": [{"calculate": "'GDP per capita'", "as": "series"}],
              "mark": {"type": "line", "point": {"filled": true}},
              "encoding": {
                "x": {"field": "yearNum", "type": "quantitative", "title": "Year", "axis": {"format": "d"}},
                "y": {"field": "gdp_pc_num", "type": "quantitative", "title": "GDP per capita (US$)", "axis": {"grid": true}},
                "color": {
                  "field": "series",
                  "type": "nominal",
                  "scale": {"domain": ["GDP per capita","Life expectancy"], "range": ["#1f77b4","#ff7f0e"]},
                  "legend": {"title": ""}
                }
              }
            },
            {
              "transform": [{"calculate": "'Life expectancy'", "as": "series"}],
              "mark": {"type": "line", "point": {"filled": true}},
              "encoding": {
                "x": {"field": "yearNum", "type": "quantitative", "title": "Year", "axis": {"format": "d"}},
                "y": {"field": "life_exp_num", "type": "quantitative", "title": "Life expectancy (years)", "axis": {"orient": "right"}},
                "color": {
                  "field": "series",
                  "type": "nominal",
                  "scale": {"domain": ["GDP per capita","Life expectancy"], "range": ["#1f77b4","#ff7f0e"]},
                  "legend": {"title": ""}
                }
              }
            }
          ],
          "resolve": {"scale": {"y": "independent"}}
        },
        {
          "title": "Malaysia",
          "data": {"url": "data/API_NY.GDP.PCAP.CD_DS2_en_csv_v2_1233921.csv", "format": {"type": "csv"}},
          "transform": [
            {"filter": "datum['Country Code'] == 'MYS'"},
            {"fold": ["1960","1970","1980","1990","2000","2010","2020"], "as": ["year","gdp_pc"]},
            {"calculate": "toNumber(datum.gdp_pc)", "as": "gdp_pc_num"},
            {"calculate": "toNumber(datum.year)", "as": "yearNum"},
            {
              "lookup": "Country Code",
              "from": {
                "data": {"url": "data/API_SP.DYN.LE00.IN_DS2_en_csv_v2_22997.csv", "format": {"type": "csv"}},
                "key": "Country Code",
                "fields": ["Indicator Code","1960","1970","1980","1990","2000","2010","2020"]
              },
              "as": ["le_indicator","le_1960","le_1970","le_1980","le_1990","le_2000","le_2010","le_2020"]
            },
            {"filter": "datum.le_indicator == 'SP.DYN.LE00.IN'"},
            {"calculate": "toNumber(datum['le_' + datum.year])", "as": "life_exp_num"},
            {"filter": "isFinite(datum.gdp_pc_num) && isFinite(datum.life_exp_num)"}
          ],
          "width": 260,
          "height": 180,
          "layer": [
            {
              "transform": [{"calculate": "'GDP per capita'", "as": "series"}],
              "mark": {"type": "line", "point": {"filled": true}},
              "encoding": {
                "x": {"field": "yearNum", "type": "quantitative", "title": "Year", "axis": {"format": "d"}},
                "y": {"field": "gdp_pc_num", "type": "quantitative", "title": "GDP per capita (US$)", "axis": {"grid": true}},
                "color": {
                  "field": "series",
                  "type": "nominal",
                  "scale": {"domain": ["GDP per capita","Life expectancy"], "range": ["#1f77b4","#ff7f0e"]},
                  "legend": {"title": ""}
                }
              }
            },
            {
              "transform": [{"calculate": "'Life expectancy'", "as": "series"}],
              "mark": {"type": "line", "point": {"filled": true}},
              "encoding": {
                "x": {"field": "yearNum", "type": "quantitative", "title": "Year", "axis": {"format": "d"}},
                "y": {"field": "life_exp_num", "type": "quantitative", "title": "Life expectancy (years)", "axis": {"orient": "right"}},
                "color": {
                  "field": "series",
                  "type": "nominal",
                  "scale": {"domain": ["GDP per capita","Life expectancy"], "range": ["#1f77b4","#ff7f0e"]},
                  "legend": {"title": ""}
                }
              }
            }
          ],
          "resolve": {"scale": {"y": "independent"}}
        }
      ]
    }
  ]
}
