{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 900,
  "height": 520,
  "projection": {"type": "mercator", "center": [140, 0], "rotate": [-180, 0, 0]},
  "params": [
    {
      "name": "yearSel",
      "value": "2024",
      "bind": {
        "input": "select",
        "options": ["2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020","2021","2022","2023","2024"],
        "name": "Year: "
      }
    }
  ],
  "layer": [
    {
      "data": {
        "url": "https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json",
        "format": {"type": "topojson", "feature": "countries"}
      },
      "transform": [
        {
          "lookup": "id",
          "from": {
            "data": {
              "values": [
                {"id":"036","iso3":"AUS"},{"id":"554","iso3":"NZL"},{"id":"702","iso3":"SGP"},
                {"id":"458","iso3":"MYS"},{"id":"360","iso3":"IDN"},{"id":"704","iso3":"VNM"},
                {"id":"608","iso3":"PHL"},{"id":"764","iso3":"THA"},{"id":"392","iso3":"JPN"},
                {"id":"410","iso3":"KOR"},{"id":"156","iso3":"CHN"},{"id":"598","iso3":"PNG"},
                {"id":"242","iso3":"FJI"},{"id":"144","iso3":"LKA"},{"id":"050","iso3":"BGD"},
                {"id":"116","iso3":"KHM"},{"id":"418","iso3":"LAO"},{"id":"104","iso3":"MMR"},
                {"id":"096","iso3":"BRN"},{"id":"626","iso3":"TLS"},{"id":"496","iso3":"MNG"},
                {"id":"524","iso3":"NPL"},{"id":"356","iso3":"IND"},{"id":"586","iso3":"PAK"}
              ]
            },
            "key": "id",
            "fields": ["iso3"]
          }
        },
        {"filter": "isValid(datum.iso3)"}
      ],
      "mark": {"type": "geoshape", "fill": "#f3f4f6", "stroke": "#bdbdbd", "strokeWidth": 0.8}
    },
    {
      "data": {
        "url": "https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json",
        "format": {"type": "topojson", "feature": "countries"}
      },
      "transform": [
        {
          "lookup": "id",
          "from": {
            "data": {
              "values": [
                {"id":"036","iso3":"AUS"},{"id":"554","iso3":"NZL"},{"id":"702","iso3":"SGP"},
                {"id":"458","iso3":"MYS"},{"id":"360","iso3":"IDN"},{"id":"704","iso3":"VNM"},
                {"id":"608","iso3":"PHL"},{"id":"764","iso3":"THA"},{"id":"392","iso3":"JPN"},
                {"id":"410","iso3":"KOR"},{"id":"156","iso3":"CHN"},{"id":"598","iso3":"PNG"},
                {"id":"242","iso3":"FJI"},{"id":"144","iso3":"LKA"},{"id":"050","iso3":"BGD"},
                {"id":"116","iso3":"KHM"},{"id":"418","iso3":"LAO"},{"id":"104","iso3":"MMR"},
                {"id":"096","iso3":"BRN"},{"id":"626","iso3":"TLS"},{"id":"496","iso3":"MNG"},
                {"id":"524","iso3":"NPL"},{"id":"356","iso3":"IND"},{"id":"586","iso3":"PAK"}
              ]
            },
            "key": "id",
            "fields": ["iso3"]
          }
        },
        {"filter": "isValid(datum.iso3)"},
        {
          "lookup": "iso3",
          "from": {
            "data": {"url": "data/API_NY.GDP.PCAP.CD_DS2_en_csv_v2_1233921.csv", "format": {"type": "csv"}},
            "key": "Country Code",
            "fields": [
              "Country Name","Country Code","Indicator Name","Indicator Code",
              "1960","1961","1962","1963","1964","1965","1966","1967","1968","1969",
              "1970","1971","1972","1973","1974","1975","1976","1977","1978","1979",
              "1980","1981","1982","1983","1984","1985","1986","1987","1988","1989",
              "1990","1991","1992","1993","1994","1995","1996","1997","1998","1999",
              "2000","2001","2002","2003","2004","2005","2006","2007","2008","2009",
              "2010","2011","2012","2013","2014","2015","2016","2017","2018","2019",
              "2020","2021","2022","2023","2024"
            ]
          }
        },
        {
          "fold": [
            "1960","1961","1962","1963","1964","1965","1966","1967","1968","1969",
            "1970","1971","1972","1973","1974","1975","1976","1977","1978","1979",
            "1980","1981","1982","1983","1984","1985","1986","1987","1988","1989",
            "1990","1991","1992","1993","1994","1995","1996","1997","1998","1999",
            "2000","2001","2002","2003","2004","2005","2006","2007","2008","2009",
            "2010","2011","2012","2013","2014","2015","2016","2017","2018","2019",
            "2020","2021","2022","2023","2024"
          ],
          "as": ["year","gdp_pc"]
        },
        {"filter": "datum.year == yearSel"},
        {"filter": "isValid(datum.gdp_pc) && datum.gdp_pc != null && datum.gdp_pc != ''"},
        {"calculate": "toNumber(datum.gdp_pc)", "as": "gdp_pc_num"}
      ],
      "mark": {"type": "geoshape"},
      "encoding": {
        "color": {"field": "gdp_pc_num", "type": "quantitative", "title": "GDP per capita (US$)", "scale": {"scheme": "blues"}},
        "tooltip": [
          {"field": "iso3", "type": "nominal", "title": "ISO3"},
          {"field": "gdp_pc_num", "type": "quantitative", "title": "GDP pc (US$)", "format": ",.0f"},
          {"field": "year", "type": "nominal", "title": "Year"}
        ]
      }
    },
    {
      "data": {
        "values": [
          {"iso3":"AUS","name":"Australia","lon":134,"lat":-25},
          {"iso3":"CHN","name":"China","lon":104,"lat":35},
          {"iso3":"IND","name":"India","lon":79,"lat":22},
          {"iso3":"JPN","name":"Japan","lon":148,"lat":36},
          {"iso3":"NZD","name":"New Zealand","lon":175,"lat":-30}
        ]
      },
      "mark": {"type": "text", "font":"Inter", "fontSize": 16, "fill":"#222", "stroke":"black", "strokeWidth": 0.5},
      "encoding": {
        "longitude": {"field":"lon", "type":"quantitative"},
        "latitude": {"field":"lat", "type":"quantitative"},
        "text": {"field":"name"}
      }
    }
  ],
  "config": {
    "view": { "stroke": "#444", "strokeWidth": 1.2 },
    "legend": { "orient": "bottom", "direction": "horizontal" }
  }
}
